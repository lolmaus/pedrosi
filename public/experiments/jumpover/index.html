<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Untitled Document</title>
<script src="raphael-min.js"></script>
</head>

<body>
<script>
var out = document.createElement("P");
document.body.appendChild(out);
out.style.right = 0;
out.style.top = 0;
out.style.width = "200px";
out.style.borderLeft = "1px solid black";
out.style.padding = "20px";
out.style.position = "fixed";

function cc(message){
	out.innerHTML+= (message  + "<br>");
}
</script>



<script>
var gameWidth = 720;
var gameHeight = 400;
var frameRate = 30;
var timeNorm = 160; //not sure why


function World(){
	this.x = 0;
	this.y = 0;
	this.w = gameWidth;
	this.h = gameHeight;
	this.gravity = 1;
	this.r = Raphael(0, 0, gameWidth, gameHeight);
 	this.r.rect(0, 0, 720, gameHeight).attr({stroke: "black"});
	this.dynamicObjects = [];
	this.staticObjects = [];
	this.timer = window.setInterval("world.onEnterFrame()", frameRate);
}
World.prototype.addObject = function(object, type){
	if(type == "dynamic")
		this.dynamicObjects.push(object);
	else if(type == "fixed")
		this.staticObjects.push(object);
	cc(this.dynamicObjects.length)
}
World.prototype.onEnterFrame = function(){
	this.applyGravity();

}
World.prototype.applyGravity = function(){
	for(var i = this.dynamicObjects.length; --i>=0;){
		this.dynamicObjects[i].ay = this.gravity;
		this.dynamicObjects[i].updatePos();
	}
}

function Floor(y, h){
	this.y = y;
	this.h = h;
	this.element = world.r.rect(0, y, gameWidth, h).attr({fill: "blue"});
}

function Cube(xPos, yPos, width, height){
	this.x = xPos;
	this.y = yPos;
	this.w = width;
	this.h = height;
	this.speedY = 0;
	this.speedX = 0;
	this.ax = 0;
	this.ay = 0;

	if(floor.y != this.y) this.y = floor.y;  //on start, touch the floor
	this.element = world.r.rect(this.x, this.y - this.h, this.w, this.h);
	this.element.attr({fill: "blue"});
	this.updatePos();
}
Cube.prototype.jump = function(height){
	if(height == undefined) height = 15;
	this.speedY -= height;
	this.element.animate({rotation: 180}, Math.sqrt(2 * height / world.gravity) * timeNorm);
}
Cube.prototype.updatePos = function(){
	this.speedX += this.ax;
	this.speedY += this.ay;
	this.x += this.speedX;
	this.y += this.speedY;

	this.constraintMovement(floor);
	this.element.attr({x: this.x, y: this.y - this.h, width:this.w, height:this.h});
}
Cube.prototype.constraintMovement = function(collisionObj){
	if(this.y > collisionObj.y){
		this.y = collisionObj.y;
	}
}

function Enemy(x, y, speedX){
	this.x = x;
	this.y = y;
	this.w = 30;
	this.h = 30;
	this.speedX = speedX;
	if(floor.y != this.y) this.y = floor.y;  //on start, touch the floor

	this.element = world.r.rect(this.x, this.y - this.h, this.w, this.h);
	this.element.attr({fill: "orange"});
	this.updatePos();
}
Enemy.prototype.updatePos = function(){
	this.x += this.speedX;

	this.element.attr({x: this.x, y: this.y - this.h, width:this.w, height:this.h});
}



var world = new World();
var floor = new Floor(300, 3);
world.addObject(floor, "fixed");
var cube = new Cube(50, 100, 30, 30);
world.addObject(cube, "dynamic");
var enemy = new Enemy(600, 100, -2);
world.addObject(enemy, "dynamic");
cube.jump();

</script>
</body>
</html>
